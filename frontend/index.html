<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HIT GenImage AI - Text to Image Chat</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .message-enter {
      animation: fadeIn 0.3s ease-out;
    }

    .loading-dots {
      animation: pulse 1.5s ease-in-out infinite;
    }

    .chat-container {
      height: calc(100vh - 140px);
    }

    .suggestion-btn {
      transition: all 0.2s ease;
    }

    .suggestion-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    /* Custom scrollbar */
    .chat-messages::-webkit-scrollbar {
      width: 6px;
    }

    .chat-messages::-webkit-scrollbar-track {
      background: #f1f5f9;
    }

    .chat-messages::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 3px;
    }

    .chat-messages::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <header class="bg-white border-b border-gray-200 sticky top-0 z-10">
    <div class="max-w-4xl mx-auto px-4 py-6">
      <div class="flex items-center justify-center">
        <div class="flex items-center space-x-4">
          <img src="Logo.png" alt="HIT GenImage AI Logo" class="w-24 h-auto"/>
          <div class="text-center">
            <h1 class="text-3xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent">
              HIT GenImage AI
            </h1>
            <p class="text-gray-600 text-sm mt-1">Describe your image and I'll generate it for you</p>
          </div>
        </div>
      </div>
    </div>
  </header>

  <div class="max-w-4xl mx-auto flex flex-col chat-container">
    <div class="flex-1 overflow-hidden">
      <div class="h-full flex flex-col">
        <div class="flex-1 overflow-y-auto px-4 py-6 chat-messages" id="chatMessages">
          <div class="message-enter mb-6 flex justify-start">
            <div class="max-w-2xl bg-white rounded-2xl rounded-bl-md shadow-sm border border-gray-200 px-4 py-3">
              <div class="flex items-start space-x-3">
                <div class="w-12 h-auto flex-shrink-0 mt-1">
                  <img src="Logo.png" alt="HIT GenImage AI Logo" class="w-full h-full object-cover"/>
                </div>
                <div>
                  <p class="text-gray-800 leading-relaxed">Hi! I'm HIT GenImage AI. Describe what image you'd like me to create, and I'll generate it for you.</p>
                  <p class="text-sm text-gray-500 mt-2">Try clicking one of the suggestions below to get started!</p>
                </div>
              </div>
            </div>
          </div>

          <div class="mb-6 flex justify-start" id="suggestionsContainer">
            <div class="max-w-2xl ml-11">
              <div class="flex flex-wrap gap-2">
                <button class="suggestion-btn bg-gradient-to-r from-blue-500 to-purple-600 text-white px-4 py-2 rounded-full text-sm font-medium hover:from-blue-600 hover:to-purple-700"
                        data-prompt="T·∫°o ·∫£nh si√™u anh h√πng batman trong DC Comics">
                  üåÉ T·∫°o ·∫£nh si√™u anh h√πng batman trong DC Comics
                </button>
                <button class="suggestion-btn bg-gradient-to-r from-green-500 to-teal-600 text-white px-4 py-2 rounded-full text-sm font-medium hover:from-green-600 hover:to-teal-700"
                        data-prompt="T·∫°o ·∫£nh Ironman trong Marvel Comics">
                  üèîÔ∏è T·∫°o ·∫£nh Ironman trong Marvel Comics
                </button>
                <button class="suggestion-btn bg-gradient-to-r from-pink-500 to-rose-600 text-white px-4 py-2 rounded-full text-sm font-medium hover:from-pink-600 hover:to-rose-700"
                        data-prompt="M·ªôt con r·ªìng h√πng vƒ© bay qua l√¢u ƒë√†i th·ªùi trung c·ªï trong l√∫c ho√†ng h√¥n, phong c√°ch gi·∫£ t∆∞·ªüng s·ª≠ thi, c·ª±c k·ª≥ chi ti·∫øt">
                  üé® M·ªôt con r·ªìng h√πng vƒ© bay qua l√¢u ƒë√†i th·ªùi trung c·ªï trong l√∫c ho√†ng h√¥n, phong c√°ch gi·∫£ t∆∞·ªüng s·ª≠ thi, c·ª±c k·ª≥ chi ti·∫øt
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="border-t border-gray-200 bg-white px-4 py-4">
      <div class="flex space-x-3">
        <div class="flex-1 relative">
          <input
            type="text"
            id="messageInput"
            placeholder="Describe the image you want to generate..."
            class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-800 placeholder-gray-500"
          />
        </div>
        <button
          id="sendButton"
          class="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-xl px-6 py-3 font-medium transition duration-200 flex items-center justify-center min-w-[60px]"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const chatMessages = document.getElementById('chatMessages');
      const messageInput = document.getElementById('messageInput');
      const sendButton = document.getElementById('sendButton');
      const suggestionsContainer = document.getElementById('suggestionsContainer');
      let isLoading = false;

      const scrollToBottom = () => {
        chatMessages.scrollTop = chatMessages.scrollHeight;
      };

      const addUserMessage = (message) => {
        const div = document.createElement('div');
        div.className = 'message-enter mb-6 flex justify-end';
        div.innerHTML = `
          <div class="max-w-2xl bg-blue-600 text-white rounded-2xl rounded-br-md px-4 py-3 shadow-sm">
            <p class="leading-relaxed">${message}</p>
          </div>
        `;
        chatMessages.appendChild(div);
        scrollToBottom();
      };

      const addAIMessage = (message) => {
        const div = document.createElement('div');
        div.className = 'message-enter mb-6 flex justify-start';
        div.innerHTML = `
          <div class="max-w-2xl bg-white rounded-2xl rounded-bl-md shadow-sm border border-gray-200 px-4 py-3">
            <div class="flex items-start space-x-3">
              <div class="w-12 h-auto flex-shrink-0 mt-1">
                <img src="Logo.png" alt="HIT GenImage AI Logo" class="w-full h-full object-cover"/>
              </div>
              <div>
                <p class="text-gray-800 leading-relaxed">${message}</p>
              </div>
            </div>
          </div>
        `;
        chatMessages.appendChild(div);
        scrollToBottom();
      };

      const addImageMessage = (base64Image, prompt) => {
        const div = document.createElement('div');
        div.className = 'message-enter mb-6 flex justify-start';
        div.innerHTML = `
          <div class="max-w-2xl bg-white rounded-2xl rounded-bl-md shadow-sm border border-gray-200 p-4">
            <div class="flex items-start space-x-3">
              <div class="w-12 h-auto flex-shrink-0 mt-1">
                <img src="Logo.png" alt="HIT GenImage AI Logo" class="w-full h-full object-cover"/>
              </div>
              <div class="flex-1">
                <p class="text-gray-800 mb-3">Here's your generated image:</p>
                <div class="rounded-lg overflow-hidden shadow-md">
                  <img src="data:image/png;base64,${base64Image}" alt="${prompt}" class="w-full h-auto max-w-md"/>
                </div>
                <p class="text-sm text-gray-500 mt-2">Prompt: "${prompt}"</p>
              </div>
            </div>
          </div>
        `;
        chatMessages.appendChild(div);
        scrollToBottom();
      };

      const addLoadingMessage = () => {
        const div = document.createElement('div');
        div.className = 'message-enter mb-6 flex justify-start';
        div.id = 'loadingMessage';
        div.innerHTML = `
          <div class="max-w-2xl bg-white rounded-2xl rounded-bl-md shadow-sm border border-gray-200 px-4 py-3">
            <div class="flex items-start space-x-3">
              <div class="w-12 h-auto flex-shrink-0 mt-1">
                <img src="Logo.png" alt="HIT GenImage AI Logo" class="w-full h-full object-cover"/>
              </div>
              <div class="flex items-center space-x-2">
                <div class="flex space-x-1">
                  <div class="w-2 h-2 bg-blue-500 rounded-full loading-dots"></div>
                  <div class="w-2 h-2 bg-blue-500 rounded-full loading-dots" style="animation-delay: 0.2s;"></div>
                  <div class="w-2 h-2 bg-blue-500 rounded-full loading-dots" style="animation-delay: 0.4s;"></div>
                </div>
                <span class="text-gray-600">Generating your image...</span>
              </div>
            </div>
          </div>
        `;
        chatMessages.appendChild(div);
        scrollToBottom();
        return div;
      };

      const removeLoadingMessage = () => {
        const loadingMsg = document.getElementById('loadingMessage');
        if (loadingMsg) {
          loadingMsg.remove();
        }
      };

      const hideSuggestions = () => {
        if (suggestionsContainer) {
          suggestionsContainer.style.display = 'none';
        }
      };

      const sendMessage = async (prompt) => {
        if (!prompt.trim() || isLoading) return;

        isLoading = true;
        sendButton.disabled = true;

        addUserMessage(prompt);
        hideSuggestions();

        const loadingDiv = addLoadingMessage();

        try {
          const response = await fetch('http://localhost:8000/v1/Text2Image', {
            method: 'POST',
            mode: 'cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ prompt })
          });

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const data = await response.json();
          removeLoadingMessage();

          if (data.info?.image_base64) {
            addImageMessage(data.info.image_base64, prompt);
          } else {
            addAIMessage('Sorry, I couldn\'t generate an image. Please try again with a different prompt.');
          }
        } catch (error) {
          removeLoadingMessage();
          addAIMessage(`‚ùå Error: ${error.message}. Please check if the server is running.`);
        } finally {
          isLoading = false;
          sendButton.disabled = false;
          messageInput.focus();
        }
      };

      // Event Listeners
      sendButton.addEventListener('click', () => {
        const prompt = messageInput.value.trim();
        if (prompt) {
          sendMessage(prompt);
          messageInput.value = '';
        }
      });

      messageInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          const prompt = messageInput.value.trim();
          if (prompt) {
            sendMessage(prompt);
            messageInput.value = '';
          }
        }
      });

      // Suggestion buttons
      document.querySelectorAll('.suggestion-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const prompt = btn.getAttribute('data-prompt');
          sendMessage(prompt);
        });
      });

      // Focus input on load
      messageInput.focus();
    });
  </script>
</body>
</html>
